#!/usr/bin/env bash

update_sink() {
    # sink=$(pacmd list-sinks | sed -n '/\* index:/ s/.*: //p')
    # sink=$(pactl list sinks | grep Name | awk '{print $2}')
    echo "Hello"
}

volume_up() {
    update_sink
    wpctl set-volume @DEFAULT_SINK@ 1%+
}

volume_down() {
    update_sink
    wpctl set-volume @DEFAULT_SINK@ 1%-
}

volume_mute() {
    update_sink
    wpctl set-mute @DEFAULT_SINK@ toggle
}

volume_print() {
    update_sink

    # active_port=$(pactl list sinks | grep Active)
    muted=$(wpctl get-mute @DEFAULT_SINK@ | awk '{print $3}')

    if echo "$active_port" | grep -q speaker && [ -n "$muted" ]; then
        icon="󰓄"
    elif echo "$active_port" | grep -q headphones && [ -n "$muted" ]; then
        icon="󰋋"
    elif echo "$active_port" | grep -q headphones && [ -n "$muted" ]; then
        icon="󰟎"
    elif echo "$active_port" | grep -q headset && [ -n "$muted" ]; then
        icon="󰋎"
    elif echo "$active_port" | grep -q headset && [ -n "$muted" ]; then
        icon="󰋐"
    elif echo "$active_port" | grep -q hdmi && [ -n "$muted" ]; then
        icon="󰽟"
    elif echo "$active_port" | grep -q hdmi && [ -n "$muted" ]; then
        icon="󰽠"
    else
        icon="󰓃"
    fi
    
    echo "$icon"
}

listen() {
    volume_print

    # pactl subscribe | while read -r event; do
    #     if echo "$event" | grep -q "change"; then
    #         volume_print
    #     fi
    # done
}

case "$1" in
    --up)
        volume_up
        ;;
    --down)
        volume_down
        ;;
    --mute)
        volume_mute
        ;;
    *)
        listen
        ;;
esac
